<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack</title>
    <link rel="icon" type="image/png" href="images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #121212;
            --card-table: #14452f;
            --text-color: #ffffff;
            --accent-color: #ffd700;
            --button-bg: #333333;
            --button-hover: #555555;
            --win-color: #4caf50;
            --lose-color: #f44336;
            --popup-bg: rgba(0, 0, 0, 0.9);
            --border-color: #52472d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            margin-bottom: 20px;
        }
        
        .title {
            font-size: 2.5rem;
            font-family: 'Monoton', 'Arial', sans-serif;
            color: var(--accent-color);
            letter-spacing: 4px;
            text-transform: uppercase;
            display: inline-flex; /* Keeps letters in a row */
            gap: 2px; /* Slight spacing between letters */
        }

        .letter {
            text-shadow: 4px 4px 0 #000, -4px -4px 0 #000, 4px -4px 0 #000, -4px 4px 0 #000, 0 0 15px rgba(255, 215, 0, 0.6);
            transition: opacity 0.1s, text-shadow 0.1s; /* Smooth flicker transitions */
        }

        /* Flicker state */
        .letter.flicker {
            animation: neonFlicker 0.5s ease-in-out; /* Short flicker duration */
        }

        @keyframes neonFlicker {
            0% {
                opacity: 1;
                text-shadow: 4px 4px 0 #000, -4px -4px 0 #000, 4px -4px 0 #000, -4px 4px 0 #000, 0 0 15px rgba(255, 215, 0, 0.6);
            }
            20% {
                opacity: 0.3;
                text-shadow: 4px 4px 0 #000, -4px -4px 0 #000, 4px -4px 0 #000, -4px 4px 0 #000, 0 0 5px rgba(255, 215, 0, 0.2);
            }
            40% {
                opacity: 1;
            }
            60% {
                opacity: 0.5;
            }
            80% {
                opacity: 0.2;
            }
            100% {
                opacity: 1;
                text-shadow: 4px 4px 0 #000, -4px -4px 0 #000, 4px -4px 0 #000, -4px 4px 0 #000, 0 0 15px rgba(255, 215, 0, 0.6);
            }
        }
        
        .balance {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .balance-amount {
            color: var(--accent-color);
            font-size: 2.0rem;
            position: relative;
            display: inline-block;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.7);
        }

        .sparkle {
            position: absolute;
            color: #ffd700;
            font-size: 0.6rem; /* Smaller stars */
            opacity: 0;
            pointer-events: none; /* Prevents interaction with stars */
            animation: sparkleStar 1s ease-in-out forwards;
        }

        @keyframes sparkleStar {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }
        
        .game-table {
            background-color: var(--card-table);
            width: 100%;
            max-width: 1000px;
            height: 670px;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 6px solid var(--border-color);
        }
        
        .dealer-area, .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 40%;
            margin-top: 0px;
        }
        
        .area-label {
            margin-top: 15px;
            margin-bottom: 3px;
            font-size: 1.2rem;
        }
        
        .score {
            margin-top: 15px;
            font-size: 1.3rem;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .cards {
            display: flex;
            justify-content: center;
            height: 150px;
            min-height: 150px;
            padding: 10px;
        }
        
        .card {
            width: 100px;
            height: 145px;
            background-color: white;
            border-radius: 5px;
            margin: 0 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.3s ease;
            position: relative;
            transform-origin: center bottom;
            opacity: 0;
            transform: translateY(30px) scale(0.9);
        }
        
        .card.dealt {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .card:hover {
            transform: translateY(-10px);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 50px;
        }
        
        .bet-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            background-color: var(--button-bg);
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 100px;
        }
        
        button:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        button.primary {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            font-weight: bold;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .bet-amount {
            font-size: 1.5rem;
            color: var(--accent-color);
        }
        
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--popup-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .popup.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .popup-content {
            background-color: var(--primary-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .popup.active .popup-content {
            transform: scale(1);
        }
        
        .popup-title {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        .win .popup-title {
            color: var(--win-color);
        }
        
        .lose .popup-title {
            color: var(--lose-color);
        }
        
        .popup-message {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .popup-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .cheat-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        
        .cheat-panel:hover {
            opacity: 1;
        }
        
        .cheat-input {
            width: 100px;
            padding: 5px;
            background-color: var(--button-bg);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
            border-radius: 3px;
        }
        
        @keyframes cardFlip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }
        
        .flip {
            animation: cardFlip 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        /* Music Player Styles */
        .music-player {
            width: 100%;
            max-width: 1000px;
            margin-bottom: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
            overflow: hidden;
        }
        
        .song-info {
            display: flex;
            align-items: center;
            width: 100%;
            text-align: center;
            justify-content: center;
            margin-bottom: 10px;
            overflow: hidden;
            height: 30px;
        }
        
        .playing-label {
            color: var(--accent-color);
            font-weight: bold;
            margin-right: 5px;
        }
        
        .song-title {
            color: var(--text-color);
            font-style: italic;
            white-space: nowrap;
        }
        
        .dots-animation {
            color: var(--accent-color);
            display: inline-block;
            width: 24px;
        }
        
        @keyframes dotAnimation {
            0% { opacity: 0; }
            33% { opacity: 1; }
            66% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .dot1, .dot2, .dot3 {
            animation: dotAnimation 1.4s infinite;
            animation-fill-mode: both;
        }
        
        .dot1 {
            animation-delay: 0s;
        }
        
        .dot2 {
            animation-delay: 0.2s;
        }
        
        .dot3 {
            animation-delay: 0.4s;
        }
        
        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            width: 100%;
            position: relative;
        }
        
        .player-btn {
            background-color: transparent;
            border: 2px solid var(--accent-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            padding: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: auto;
        }
        
        .player-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            transform: scale(1.1);
        }
        
        .player-btn:active {
            transform: scale(0.95);
        }
        
        #play-pause {
            width: 50px;
            height: 50px;
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }
        
        #play-pause:hover {
            background-color: var(--text-color);
            border-color: var(--text-color);
        }
        
        .play-icon, .pause-icon {
            position: absolute;
            transition: all 0.3s ease;
        }
        
        .play-icon {
            opacity: 0;
            transform: scale(0);
        }
        
        .pause-icon {
            opacity: 1;
            transform: scale(1);
        }
        
        #play-pause.play .play-icon {
            opacity: 1;
            transform: scale(1);
        }
        
        #play-pause.play .pause-icon {
            opacity: 0;
            transform: scale(0);
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            right: 10px;
            color: var(--accent-color);
            width: 40px;
            overflow: hidden;
            transition: width 0.3s ease;
        }
        
        .volume-control:hover {
            width: 150px;
        }
        
        #volume-slider {
            -webkit-appearance: none;
            width: 100px;
            height: 4px;
            background: var(--button-bg);
            border-radius: 2px;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .volume-control:hover #volume-slider {
            opacity: 1;
        }
        
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: -100px 0 0 100px var(--accent-color);
        }
        
        #volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: -100px 0 0 100px var(--accent-color);
            border: none;
        }
        
        @keyframes equalizer {
            0% { height: 5px; }
            50% { height: 15px; }
            100% { height: 5px; }
        }
        
        @media (max-width: 600px) {
            .music-player {
                padding: 10px;
            }
            
            .player-btn {
                width: 35px;
                height: 35px;
            }
            
            #play-pause {
                width: 45px;
                height: 45px;
            }
            
            #volume-slider {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">
            <span class="letter">B</span>
            <span class="letter">l</span>
            <span class="letter">a</span>
            <span class="letter">c</span>
            <span class="letter">k</span>
            <span class="letter">j</span>
            <span class="letter">a</span>
            <span class="letter">c</span>
            <span class="letter">k</span>
        </h1>
        <div class="balance">
            $<span class="balance-amount">1000</span>
        </div>
    </div>
    
    <div class="music-player">
        <div class="song-info">
            <span class="playing-label">Playing: </span>
            <span class="song-title">Casino Royale Jazz</span>
            <span class="dots-animation"><span class="dot1">.</span><span class="dot2">.</span><span class="dot3">.</span></span>
        </div>
        <div class="player-controls">
            <button id="prev-song" class="player-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M6,5 L6,19 L8,19 L8,5 L6,5 Z M18,5 L10,12 L18,19 L18,5 Z"></path>
                </svg>
            </button>
            <button id="play-pause" class="player-btn play">
                <svg viewBox="0 0 24 24" width="24" height="24" class="play-icon">
                    <path fill="currentColor" d="M8,5 L8,19 L19,12 L8,5 Z"></path>
                </svg>
                <svg viewBox="0 0 24 24" width="24" height="24" class="pause-icon">
                    <path fill="currentColor" d="M6,5 L10,5 L10,19 L6,19 L6,5 Z M14,5 L18,5 L18,19 L14,19 L14,5 Z"></path>
                </svg>
            </button>
            <button id="next-song" class="player-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M16,5 L16,19 L18,19 L18,5 L16,5 Z M6,5 L14,12 L6,19 L6,5 Z"></path>
                </svg>
            </button>
            <div class="volume-control">
                <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M3,9 L7,9 L12,4 L12,20 L7,15 L3,15 L3,9 Z M16,7 C17.8,8.7 18.8,10.8 18.8,12.9 C18.8,15.1 17.8,17.2 16,18.9 L14.9,17.8 C16.4,16.3 17.2,14.7 17.2,12.9 C17.2,11.1 16.4,9.5 14.9,8 L16,7 Z"></path>
                </svg>
                <input type="range" id="volume-slider" min="0" max="100" value="70">
            </div>
        </div>
    </div>
    
    <div class="game-table">
        <div class="dealer-area">
            <div class="area-label">Dealer</div>
            <div class="cards dealer-cards"></div>
            <div class="score dealer-score">Score: 0</div>
        </div>
        
        <div class="player-area">
            <div class="score player-score">Score: 0</div>
            <div class="cards player-cards"></div>
            <div class="area-label">Player</div>
            <div class="controls">
                <button id="deal-btn" class="primary">Deal</button>
                <button id="hit-btn" disabled>Hit</button>
                <button id="stand-btn" disabled>Stand</button>
                <button id="double-btn" disabled>Double</button>
            </div>
            <div class="bet-controls">
                <button id="decrease-bet">-</button>
                <div class="bet-amount">$<span id="bet-value">25</span></div>
                <button id="increase-bet">+</button>
            </div>
        </div>
        
        <div class="cheat-panel">
            <input type="number" class="cheat-input" id="cheat-amount" placeholder="Amount">
            <button id="add-money">Add</button>
        </div>
    </div>
    
    <div class="popup" id="result-popup">
        <div class="popup-content">
            <h2 class="popup-title" id="result-title"></h2>
            <p class="popup-message" id="result-message"></p>
            <div class="popup-buttons">
                <button id="play-again" class="primary">Play Again</button>
            </div>
        </div>
    </div>
    
    <script>
        // Game state variables
        let playerCards = [];
        let dealerCards = [];
        let deck = [];
        let playerScore = 0;
        let dealerScore = 0;
        let playerBalance = 1000;
        let currentBet = 25;
        let gameInProgress = false;
        let dealersTurn = false;
        
        // DOM elements
        const dealBtn = document.getElementById('deal-btn');
        const hitBtn = document.getElementById('hit-btn');
        const standBtn = document.getElementById('stand-btn');
        const doubleBtn = document.getElementById('double-btn');
        const increaseBtn = document.getElementById('increase-bet');
        const decreaseBtn = document.getElementById('decrease-bet');
        const addMoneyBtn = document.getElementById('add-money');
        const cheatAmountInput = document.getElementById('cheat-amount');
        const betValueSpan = document.getElementById('bet-value');
        const balanceAmount = document.querySelector('.balance-amount');
        const playerCardsEl = document.querySelector('.player-cards');
        const dealerCardsEl = document.querySelector('.dealer-cards');
        const playerScoreEl = document.querySelector('.player-score');
        const dealerScoreEl = document.querySelector('.dealer-score');
        const resultPopup = document.getElementById('result-popup');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const playAgainBtn = document.getElementById('play-again');
        
        // Card suits and values
        const suits = ['clubs', 'diamonds', 'hearts', 'spades'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'jack', 'queen', 'king', 'ace'];
        
        // Initialize the game
        function initGame() {
            updateBalance();
            dealBtn.addEventListener('click', startGame);
            hitBtn.addEventListener('click', hit);
            standBtn.addEventListener('click', stand);
            doubleBtn.addEventListener('click', double);
            increaseBtn.addEventListener('click', increaseBet);
            decreaseBtn.addEventListener('click', decreaseBet);
            addMoneyBtn.addEventListener('click', addMoney);
            playAgainBtn.addEventListener('click', resetGame);
        }

        function startLetterFlicker() {
            const letters = document.querySelectorAll('.letter');

            function flickerLetter(letter) {
                // Add flicker class
                letter.classList.add('flicker');

                // Remove class after animation ends to allow retriggering
                letter.addEventListener('animationend', () => {
                    letter.classList.remove('flicker');
                }, { once: true });
            }

            // Randomly flicker letters at intervals
            letters.forEach(letter => {
                setInterval(() => {
                    // 20% chance to flicker every 2-5 seconds
                    if (Math.random() < 0.2) {
                        flickerLetter(letter);
                    }
                }, Math.random() * 3000 + 2000); // Random interval between 2s and 5s
            });
        }

        function addSparkles() {
            const balanceAmount = document.querySelector('.balance-amount');
            const sparkleCount = 3; // Number of stars at a time

            function createSparkle() {
                const sparkle = document.createElement('span');
                sparkle.classList.add('sparkle');
                sparkle.textContent = 'âœ¦'; // Star symbol

                // Random position around the balance
                const x = Math.random() * 40 - 20; // -20px to 20px from center
                const y = Math.random() * 40 - 20;
                sparkle.style.left = `calc(50% + ${x}px)`;
                sparkle.style.top = `${y}px`;

                // Random size
                const size = Math.random() * 0.5 + 0.5; // 0.5rem to 1rem
                sparkle.style.fontSize = `${size}rem`;

                // Random animation duration
                const duration = Math.random() * 1 + 0.5; // 0.5s to 1.5s
                sparkle.style.animationDuration = `${duration}s`;

                balanceAmount.appendChild(sparkle);

                // Remove after animation
                sparkle.addEventListener('animationend', () => {
                    sparkle.remove();
                });
            }

            // Create sparkles at intervals
            setInterval(() => {
                if (Math.random() > 0.3) { // 70% chance to spawn each interval
                    createSparkle();
                }
            }, 300); // New sparkle every 300ms
        }
        
        // Create a deck of cards
        function createDeck() {
            const newDeck = [];
            
            for (let suit of suits) {
                for (let value of values) {
                    newDeck.push({
                        suit: suit,
                        value: value,
                        imgName: `images/${value}_of_${suit}.png`
                    });
                }
            }
            
            return newDeck;
        }
        
        // Shuffle the deck
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }
        
        // Start a new game
        function startGame() {
            if (currentBet > playerBalance) {
                alert("You don't have enough money!");
                return;
            }
            
            gameInProgress = true;
            dealersTurn = false;
            
            // Reset
            playerCards = [];
            dealerCards = [];
            playerCardsEl.innerHTML = '';
            dealerCardsEl.innerHTML = '';
            
            // Create and shuffle deck
            deck = shuffleDeck(createDeck());
            
            // Update balance
            playerBalance -= currentBet;
            updateBalance();
            
            // Deal initial cards
            dealCard(playerCards, playerCardsEl, true);
            dealCard(dealerCards, dealerCardsEl, true);
            dealCard(playerCards, playerCardsEl, true);
            dealCard(dealerCards, dealerCardsEl, false);
            
            // Update scores
            updateScores();
            
            // Update buttons
            dealBtn.disabled = true;
            hitBtn.disabled = false;
            standBtn.disabled = false;
            doubleBtn.disabled = playerBalance < currentBet ? true : false;
            increaseBtn.disabled = true;
            decreaseBtn.disabled = true;
            
            // Check for blackjack
            checkForBlackjack();
        }
        
        // Deal a card
        function dealCard(hand, element, faceUp = true) {
            const card = deck.pop();
            hand.push(card);
            
            const cardEl = document.createElement('div');
            cardEl.classList.add('card');
            
            if (faceUp) {
                cardEl.style.backgroundImage = `url(${card.imgName})`;
            } else {
                cardEl.style.backgroundImage = 'url(images/back.png)';
                cardEl.dataset.hidden = 'true';
                cardEl.dataset.imgName = card.imgName;
            }
            
            element.appendChild(cardEl);
            
            // Animate the card
            setTimeout(() => {
                cardEl.classList.add('dealt');
            }, 50);
            
            return card;
        }
        
        // Calculate hand score
        function calculateScore(hand) {
            let score = 0;
            let aces = 0;
            
            for (let card of hand) {
                if (card.value === 'ace') {
                    aces++;
                    score += 11;
                } else if (['jack', 'queen', 'king'].includes(card.value)) {
                    score += 10;
                } else {
                    score += parseInt(card.value);
                }
            }
            
            // Adjust for aces
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            
            return score;
        }
        
        // Update scores
        function updateScores() {
            playerScore = calculateScore(playerCards);
            dealerScore = calculateScore(dealerCards);
            
            playerScoreEl.textContent = `Score: ${playerScore}`;
            
            // Only show dealer's score for face-up cards
            if (!dealersTurn) {
                const visibleDealerCards = dealerCards.slice(0, 1);
                dealerScoreEl.textContent = `Score: ${calculateScore(visibleDealerCards)}`;
            } else {
                dealerScoreEl.textContent = `Score: ${dealerScore}`;
            }
        }
        
        // Hit - get another card
        function hit() {
            if (!gameInProgress) return;
            
            const card = dealCard(playerCards, playerCardsEl, true);
            updateScores();
            
            // Disable double after hit
            doubleBtn.disabled = true;
            
            // Check if player busts
            if (playerScore > 21) {
                endGame("bust");
            }
        }
        
        // Stand - end player's turn
        function stand() {
            if (!gameInProgress) return;
            
            dealersTurn = true;
            
            // Flip dealer's hidden card
            const hiddenCard = dealerCardsEl.querySelector('[data-hidden="true"]');
            if (hiddenCard) {
                hiddenCard.classList.add('flip');
                setTimeout(() => {
                    hiddenCard.style.backgroundImage = `url(${hiddenCard.dataset.imgName})`;
                    hiddenCard.removeAttribute('data-hidden');
                    updateScores();
                    
                    // Add additional delay before dealer starts drawing
                    setTimeout(() => {
                        dealerPlay();
                    }, 700); // Match the delay used in dealerDraw
                    
                }, 250);
            } else {
                dealerPlay();
            }
        }
        
        // Double - double the bet and get one more card
        function double() {
            if (!gameInProgress || playerBalance < currentBet) return;
            
            playerBalance -= currentBet;
            currentBet *= 2;
            updateBalance();
            
            const card = dealCard(playerCards, playerCardsEl, true);
            updateScores();
            
            if (playerScore > 21) {
                endGame("bust");
            } else {
                stand();
            }
        }
        
        // Dealer's play
        function dealerPlay() {
            if (playerScore > 21) {
                endGame("bust");
                return;
            }
            
            const dealerDraw = () => {
                if (dealerScore < 17) {
                    dealCard(dealerCards, dealerCardsEl, true);
                    updateScores();
                    
                    setTimeout(() => {
                        dealerDraw();
                    }, 700);
                } else {
                    determineWinner();
                }
            };
            
            dealerDraw();
        }
        
        // Check for blackjack (natural 21)
        function checkForBlackjack() {
            if (playerScore === 21 && playerCards.length === 2) {
                // Flip dealer's hidden card
                const hiddenCard = dealerCardsEl.querySelector('[data-hidden="true"]');
                if (hiddenCard) {
                    hiddenCard.classList.add('flip');
                    setTimeout(() => {
                        hiddenCard.style.backgroundImage = `url(${hiddenCard.dataset.imgName})`;
                        hiddenCard.removeAttribute('data-hidden');
                        updateScores();
                        
                        if (dealerScore === 21 && dealerCards.length === 2) {
                            // Both have blackjack - push
                            endGame("push");
                        } else {
                            // Player has blackjack, dealer doesn't
                            endGame("blackjack");
                        }
                    }, 250);
                }
            }
        }
        
        // Determine the winner
        function determineWinner() {
            if (playerScore > 21) {
                endGame("bust");
            } else if (dealerScore > 21) {
                endGame("dealer_bust");
            } else if (playerScore > dealerScore) {
                endGame("win");
            } else if (playerScore < dealerScore) {
                endGame("lose");
            } else {
                endGame("push");
            }
        }
        
        // End the game
        function endGame(result) {
            gameInProgress = false;
            
            let payout = 0;
            let title = "";
            let message = "";
            let popupClass = "";
            
            switch (result) {
                case "blackjack":
                    payout = currentBet * 2.5;
                    title = "Blackjack!";
                    message = `Congratulations! You got a Blackjack and won $${payout.toFixed(2)}!`;
                    popupClass = "win";
                    break;
                case "win":
                    payout = currentBet * 2;
                    title = "You Win!";
                    message = `You won $${payout.toFixed(2)}!`;
                    popupClass = "win";
                    break;
                case "dealer_bust":
                    payout = currentBet * 2;
                    title = "Dealer Busts!";
                    message = `Dealer went over 21. You won $${payout.toFixed(2)}!`;
                    popupClass = "win";
                    break;
                case "lose":
                    payout = 0;
                    title = "You Lose";
                    message = `Dealer wins with ${dealerScore} against your ${playerScore}.`;
                    popupClass = "lose";
                    break;
                case "bust":
                    payout = 0;
                    title = "Bust!";
                    message = "You went over 21 and lost your bet.";
                    popupClass = "lose";
                    break;
                case "push":
                    payout = currentBet;
                    title = "Push";
                    message = "It's a tie! Your bet has been returned.";
                    popupClass = "";
                    break;
            }
            
            playerBalance += payout;
            updateBalance();
            
            // Disable game buttons
            hitBtn.disabled = true;
            standBtn.disabled = true;
            doubleBtn.disabled = true;
            
            // Show popup after a short delay
            setTimeout(() => {
                resultTitle.textContent = title;
                resultMessage.textContent = message;
                resultPopup.className = "popup active " + popupClass;
                
                if (playerBalance < 5) {
                    resultMessage.textContent += " You're running low on funds. Use the cheat panel to add more money!";
                }
            }, 1000);
        }
        
        // Reset game
        function resetGame() {
            gameInProgress = false;
            dealersTurn = false;
            
            // Reset bet if necessary
            if (currentBet > playerBalance) {
                currentBet = Math.min(25, playerBalance);
            }
            
            // Enable buttons
            dealBtn.disabled = false;
            hitBtn.disabled = true;
            standBtn.disabled = true;
            doubleBtn.disabled = true;
            increaseBtn.disabled = false;
            decreaseBtn.disabled = false;
            
            // Update display
            updateBetDisplay();
            resultPopup.classList.remove('active');
        }
        
        // Increase bet
        function increaseBet() {
            if (gameInProgress) return;
            
            const increments = [5, 25, 50, 100, 250, 500, 1000];
            let nextIncrement = 25;
            
            for (let inc of increments) {
                if (currentBet < inc) {
                    nextIncrement = inc;
                    break;
                }
            }
            
            if (currentBet < playerBalance) {
                currentBet = Math.min(nextIncrement, playerBalance);
                updateBetDisplay();
            }
        }
        
        // Decrease bet
        function decreaseBet() {
            if (gameInProgress) return;
            
            const increments = [5, 25, 50, 100, 250, 500, 1000];
            let prevIncrement = 5;
            
            for (let i = increments.length - 1; i >= 0; i--) {
                if (currentBet > increments[i]) {
                    prevIncrement = increments[i];
                    break;
                }
            }
            
            if (currentBet > 5) {
                currentBet = Math.max(prevIncrement, 5);
                updateBetDisplay();
            }
        }
        
        // Add money (cheat)
        function addMoney() {
            const amount = parseInt(cheatAmountInput.value) || 0;
            if (amount > 0) {
                playerBalance += amount;
                updateBalance();
                cheatAmountInput.value = '';
                
                // Apply pulse animation to balance
                balanceAmount.classList.add('pulse');
                setTimeout(() => {
                    balanceAmount.classList.remove('pulse');
                }, 500);
            }
        }
        
        // Update bet display
        function updateBetDisplay() {
            betValueSpan.textContent = currentBet;
        }
        
        // Update balance display
        function updateBalance() {
            balanceAmount.textContent = playerBalance;
        }
        
        // Music Player functionality
        const musicPlayer = (function() {
            // Playlist of casino jazz music from YouTube
            const playlist = [
                { title: "Casino Jazz", url: "https://www.youtube.com/watch?v=8w5ELqXNlvk" },
                
            ];
            
            // Variables
            let currentTrack = 0;
            let isPlaying = false;
            let audio = null;
            
            // DOM elements
            const playPauseBtn = document.getElementById('play-pause');
            const prevBtn = document.getElementById('prev-song');
            const nextBtn = document.getElementById('next-song');
            const volumeSlider = document.getElementById('volume-slider');
            const songTitle = document.querySelector('.song-title');
            
            // Extract YouTube ID from URL
            function getYouTubeID(url) {
                const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[7].length === 11) ? match[7] : false;
            }
            
            // Initialize music player
            function init() {
                // Create YouTube IFrame API script
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                
                // Set up event listeners
                playPauseBtn.addEventListener('click', togglePlay);
                prevBtn.addEventListener('click', playPrevious);
                nextBtn.addEventListener('click', playNext);
                volumeSlider.addEventListener('input', setVolume);
                
                // Initialize with the first track
                updateSongTitle();
                
                // Global callback for when YouTube API is ready
                window.onYouTubeIframeAPIReady = function() {
                    createPlayer();
                };
            }
            
            // Create YouTube player
            function createPlayer() {
                const videoId = getYouTubeID(playlist[currentTrack].url);
                
                // Create a hidden YouTube player
                const playerDiv = document.createElement('div');
                playerDiv.id = 'youtube-player';
                playerDiv.style.display = 'none';
                document.body.appendChild(playerDiv);
                
                // Initialize YouTube player
                audio = new YT.Player('youtube-player', {
                    height: '0',
                    width: '0',
                    videoId: videoId,
                    playerVars: {
                        'autoplay': 0,
                        'controls': 0,
                        'disablekb': 1,
                        'fs': 0,
                        'rel': 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
            
            // When player is ready
            function onPlayerReady(event) {
                setVolume();
            }
            
            // When player state changes
            function onPlayerStateChange(event) {
                // If video ended, play next
                if (event.data === YT.PlayerState.ENDED) {
                    playNext();
                }
                
                // Update play/pause button
                if (event.data === YT.PlayerState.PLAYING) {
                    playPauseBtn.classList.remove('play');
                    isPlaying = true;
                } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
                    playPauseBtn.classList.add('play');
                    isPlaying = false;
                }
            }
            
            // Toggle play/pause
            function togglePlay() {
                if (!audio) return;
                
                if (isPlaying) {
                    audio.pauseVideo();
                } else {
                    audio.playVideo();
                }
            }
            
            // Play previous track
            function playPrevious() {
                if (!audio) return;
                
                currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
                loadTrack();
            }
            
            // Play next track
            function playNext() {
                if (!audio) return;
                
                currentTrack = (currentTrack + 1) % playlist.length;
                loadTrack();
            }
            
            // Load current track
            function loadTrack() {
                const videoId = getYouTubeID(playlist[currentTrack].url);
                audio.loadVideoById(videoId);
                updateSongTitle();
            }
            
            // Set volume
            function setVolume() {
                if (!audio) return;
                
                const volume = volumeSlider.value;
                audio.setVolume(volume);
            }
            
            // Update song title
            function updateSongTitle() {
                songTitle.textContent = playlist[currentTrack].title;
            }
            
            return {
                init: init
            };
        })();

        // Initialize the music player
        window.addEventListener('DOMContentLoaded', function() {
            initGame();
            musicPlayer.init();
        });

        // Start flickering when the page loads
        window.addEventListener('DOMContentLoaded', startLetterFlicker);

        // Start sparkles when the page loads
        window.addEventListener('DOMContentLoaded', addSparkles);
    </script>
</body>
</html>
